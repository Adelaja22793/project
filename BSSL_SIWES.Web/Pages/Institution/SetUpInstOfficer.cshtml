@page
@model BSSL_SIWES.Web.Pages.Institution.SetUpInstOfficerModel
@{
    ViewData["Title"] = "SetUpInstOfficer";
}


<div class="col-md-12">
    <div class="card card-primary">
        <div class="card-header">
            <h4 class="card-title">Institiution Officer Setup</h4>
        </div>

        <form role="form">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputFile">Institiution Name</label>
                            <input type="text" class="form-control" id="drpinstitiu" asp-for="InstitionNmae.Name"  readonly="readonly">
                            <input type="hidden" asp-for="InstitionNmae.Id" id="instId" />

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputFile">Institiution Address</label>
                           <input type="text" class="form-control" id="institiuaddress" asp-for="InstitionNmae.Address1" readonly="readonly" >

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">Officer Name</label>
                            <input type="text" class="form-control" id="officername"  onchange="MyFunctionMatricNumber()">
                            <input type="hidden" id="officernameId" />
                        </div>
                    </div>
                    <div class="col-sm-4 studentSelectedActivities">
                        <div class="form-group">
                            <label>Officer Type</label>
                            <select class="form-control" id="officertype">
                                <option selected="selected">--Select Officer Type--</option>
                                <option value="Coordinator">Coordinator</option>
                                <option value="Supervisor">Supervisor</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">Designation</label>
                            <input type="text" class="form-control" id="designa">

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">Address 1</label>                         
                            <input type="text" class="form-control" id="address1">

                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">Phone</label>                          
                            <input type="text" class="form-control" id="Phone">

                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">E-mail</label>                           
                           <input type="text" class="form-control" id="email">

                        
                        </div>
                    </div>
                </div>
             
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label>Select Nationality</label>
                            <select class="form-control" asp-items="ViewBag.NationalityId"
                                   style="width: 100%; text-transform:uppercase"
                                    onchange="MyFunctionNationality()" id="nationChange">
                                <option selected="selected" value="-1">-- Select Nationality--</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label>Select State of Origin</label>
                            <select class="form-control"
                                    id="myState" style="width: 100%;" onchange="MyFunctionState()">
                                <option selected="selected" value="-1">-- Select State--</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label>Select LGA of Origin</label>
                            <select class="form-control"
                                    id="myLGA" style="width: 100%;">
                                <option selected="selected" value="-1">--Select LGA--</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                   
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">No. Of Student Currently Supervising</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                </div>
                                <input type="text" class="form-control" id="noofstu" placeholder="No. Of Student">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputFile">Select Bank</label>
                            <select class="form-control regYear" style="width: 100%;" id="drpbank">
                                <option selected="selected" value="-1">--Select Bank--</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputFile">Enter Account Number</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" style="width: 100%;"><i class="fas fa-sort-numeric-asc"></i></span>
                                </div>
                                <input type="text" class="form-control" id="accountnum">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputFile">Enter Account Name</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-sort-numeric-asc"></i></span>
                                </div>
                                <input type="text" class="form-control" id="accountname">

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="exampleInputFile">Enter Switch Code</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-sort-numeric-asc"></i></span>
                                </div>
                                <input type="text" class="form-control" id="switchcode">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="justify-content-center" style="margin-left:23%; margin-bottom:3%;">
                <button type="button" id="Btnsave" class="btn btn-primary">Submit</button>
                <button type="button" id="Btnupdate" class="btn btn-warning" style="display:none">Update</button>
            </div>
        </form>
    </div>

</div>


<script type="text/javascript">
    var studentList = [];

    function addStudents(lbl, val) {
        studentList.push({ label: lbl, value: val });
    }
    $(document).ready(function () {
        @{
            if (Model.InstitutionOfficers != null)
            {
                foreach (var item in Model.InstitutionOfficers)
                {
                    @:addStudents('@item.IntOfficerName.ToString().Trim()', '@item.Id');
                }
            }
            else
            {

            }
            }

        $("#officername").autocomplete({
            source: studentList,
            select: function (event, ui) {
                $('#officername').val(ui.item.label);
                $('#officernameId').val(ui.item.value);
                return false;
            }
        });


        $('#Btnsave').on('click', function () {
            //alert("uedhduedehdu");
            var instId = $('#instId').val();
            //var institiuaddress = $('#institiuaddress').val();
            var officertype = $("div.studentSelectedActivities select").val();
            //var officertype = $('#officertype').val();
            var offidnum = $('#offidnum').val();
            var officername = $('#officername').val();
            var designa = $('#designa').val();
            var address1 = $('#address1').val();
            //var nationChange = $('#nationChange').val();
            //var myState = $('#myState').val();
            var myLGA = $('#myLGA').val();
            var Phone = $('#Phone').val();
            var email = $('#email').val();
            var noofstu = $('#noofstu').val();
            //var drpbank = $('#drpbank').val();
            var accountnum = $('#accountnum').val();
            var accountname = $('#accountname').val();
            var switchcode = $('#switchcode').val();
            var InstitutionId = parseInt(instId);
            var NumberOfStudent = parseInt(noofstu);
            //alert(instId);
            //alert(drpagency);
            //alert(txtdeactDate);
            //alert(institiuaddress);
            //alert(officertype);
            //alert(offidnum);
            //alert(officername);
            //alert(designa);


            var d = {
                "InstitutionId": InstitutionId,
                //"Deactivate": drpagency,
                //"DateActivated": txtdeactDate,
                //"InstitiutionAddress": institiuaddress,
                "OfficerType": officertype,
                //"StaffId": offidnum,
                "IntOfficerName": officername,
                "IntOfficerDesig": designa,
                "Address1": address1,
                //"Address2": address2,
                //"NationalityId": nationChange,
                //"StatesId": myState,
                "StaffId": myLGA,
                "PhoneNo": Phone,
                "Email": email,
                //"BankName": drpbank,
                "AccountNo": accountnum,
                "AccountName": accountname,
                "SwitchCode": switchcode,
                "NumberOfStudent": NumberOfStudent,
            };
            var baseUrl = window.location.origin;
            $.ajax({
                type: "POST",
                url: baseUrl + '/Api/InstitutionOfficers',
                data: JSON.stringify(d),
                xhrFields: {
                    withCredentials: true
                },
                contentType: "application/json; charset=utf-8",
                error: function (data) {
                    alert(data.responseText);
                },
                failure: function (data) {
                    alert(data.responseText);
                },
                success: function (data) {
                    alert("RECORD SUCCESSFULLY SAVED");
                    location.reload();
                },
            });

        });
        $('#Btnupdate').on('click', function () {
            //alert("uedhduedehdu");
            var instId = $('#instId').val();
            //var institiuaddress = $('#institiuaddress').val();
            var officertype = $("div.studentSelectedActivities select").val();
            //var officertype = $('#officertype').val();
            var offidnum = $('#offidnum').val();
            var officername = $('#officername').val();
            var designa = $('#designa').val();
            var address1 = $('#address1').val();
            //var nationChange = $('#nationChange').val();
            //var myState = $('#myState').val();
            var myLGA = $('#myLGA').val();
            var Phone = $('#Phone').val();
            var email = $('#email').val();
            var noofstu = $('#noofstu').val();
            //var drpbank = $('#drpbank').val();
            var accountnum = $('#accountnum').val();
            var accountname = $('#accountname').val();
            var switchcode = $('#switchcode').val();
            var InstitutionId = parseInt(instId);
            var NumberOfStudent = parseInt(noofstu);
            //alert(instId);
            //alert(drpagency);
            //alert(txtdeactDate);
            //alert(institiuaddress);
            //alert(officertype);
            //alert(offidnum);
            //alert(officername);
            //alert(designa);


            var d = {
                "InstitutionId": InstitutionId,
                //"Deactivate": drpagency,
                //"DateActivated": txtdeactDate,
                //"InstitiutionAddress": institiuaddress,
                "OfficerType": officertype,
                //"StaffId": offidnum,
                "IntOfficerName": officername,
                "IntOfficerDesig": designa,
                "Address1": address1,
                //"Address2": address2,
                //"NationalityId": nationChange,
                //"StatesId": myState,
                "StaffId": myLGA,
                "PhoneNo": Phone,
                "Email": email,
                //"BankName": drpbank,
                "AccountNo": accountnum,
                "AccountName": accountname,
                "SwitchCode": switchcode,
                "NumberOfStudent": NumberOfStudent,
            };
            var baseUrl = window.location.origin;
            $.ajax({
                type: "PUT",
                url: baseUrl + '/Api/InstitutionOfficers' + ,
                data: JSON.stringify(d),
                xhrFields: {
                    withCredentials: true
                },
                contentType: "application/json; charset=utf-8",
                error: function (data) {
                    alert(data.responseText);
                },
                failure: function (data) {
                    alert(data.responseText);
                },
                success: function (data) {
                    alert("RECORD SUCCESSFULLY SAVED");
                    location.reload();
                },
            });

        });
    });

    function MyFunctionNationality() {
        var nationId = document.getElementById('nationChange').value;
        var d = {
            "Id": nationId
        };
        var baseUrl = window.location.origin;
        $.ajax({
            type: "GET",
            url: baseUrl + '/Api/States/' + nationId,
            data: JSON.stringify(d),
            xhrFields: {
                withCredentials: true
            },
            contentType: 'json',
            error: function (data) {
                alert(data.responseText);
            },
            failure: function (data) {
                alert(data.responseText);
            },
            success: function (data) {
                //console.log(data);
                $('#myLGA').empty();
                $('#myLGA').append('<option value=-1>--Select LGA--</option>');
                var option = '';
                for (var i = 0; i < data.length; i++) {
                    option += '<option value="' + data[i]['id'] + '">' + data[i]['name'] + '</option>';
                }
                //alert(option);
                if (option == "") {
                    $('#myState').empty();
                    $('#myState').append('<option value=-1>--Select State--</option>');
                }
                $('#myState').append(option);

            },
        });

    }
    function MyFunctionState() {
        var stateId = document.getElementById('myState').value;
        // alert(stateId);
        var d = {
            "Id": stateId
        };
        var baseUrl = window.location.origin;
        $.ajax({
            type: "GET",
            url: baseUrl + '/Api/LGAs/' + stateId,
            data: JSON.stringify(d),
            xhrFields: {
                withCredentials: true
            },
            contentType: 'json',
            error: function (data) {
                alert(data.responseText);
            },
            failure: function (data) {
                alert(data.responseText);
            },
            success: function (data) {
                // console.log(data);
                $('#myLGA').empty();
                $('#myLGA').append('<option value=-1>--Select LGA--</option>');
                var option = '';
                for (var i = 0; i < data.length; i++) {
                    option += '<option value="' + data[i]['id'] + '">' + data[i]['name'] + '</option>';
                }
                //alert(option);
                if (option == "") {
                    $('#myLGA').empty();
                    $('#myLGA').append('<option value=-1>--Select LGA--</option>');
                }

                //$('#myLGA').append('<option value=-1>--Select LGA--</option>');
                $('#myLGA').append(option);

            },
        });

    }
</script>