@page
@model BSSL_SIWES.Web.PolicySetupModel
@inject SiwesData.ApplicationDbContext db
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Identity;
@{
    ViewData["Title"] = "PolicySetup";
}


    <div class="col-md-12">
        <!-- general form elements -->
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Policy Setup</h3>
            </div>
            <!-- /.card-header -->
            <!-- form start -->
            <form role="form" method="post">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-10">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>Institution Type </label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-6">
                                        <select asp-for="PolicyTb.InstypeId" class="form-control select2 select2-purple" data-dropdown-css-class="select2-purple"
                                                asp-items="ViewBag.InstituTypes" style="width: 100%; text-transform:uppercase" id="drpgroup">
                                            <option selected="selected" value="">-- Select Institution Type --</option>
                                        </select>
                                    </div>
                                </div>
                                <span asp-validation-for="PolicyTb.InstypeId" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="custom-control custom-checkbox custom-control-inline">
                                        <input type="checkbox" asp-for="PolicyTb.MustNotExcCap" class="custom-control-input" id="MustNotExc" />
                                        <label class="custom-control-label" for="MustNotExc">
                                            Institutions must not exceed carrying capacity.
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>Allow maximum of </label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-2">
                                        <input asp-for="PolicyTb.MasterListDate" type="text" class="form-control" id="txtmasterlist">
                                    </div>
                                    <span style="width:10px"></span>
                                    <label>times for SIWES IT attachment for Institutions.</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" asp-for="PolicyTb.AllowDisporal" class="custom-control-input" id="chkAllowDisporal" />
                                    <label class="custom-control-label" for="chkAllowDisporal">
                                        Allow IT Attachment for Diaspora Student
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" asp-for="PolicyTb.AllowInternal" class="custom-control-input" id="chkAllowInternal" />
                                    <label class="custom-control-label" for="chkAllowInternal">
                                        Allow IT Attachment for Nigerian Student
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>Supervisor amount per student  </label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-2">
                                        <input type="text" asp-for="PolicyTb.SuperAmt" class="form-control" id="txtsuperamt">
                                    </div>
                                </div>
                            </div>
                            <span asp-validation-for="PolicyTb.SuperAmt" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="input-group">
                                    <label for="exampleInputFile">Amount per student/duration   </label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-2">
                                        <input type="text" asp-for="PolicyTb.StudentAmt" class="form-control" id="txtstudentamt">
                                    </div>
                                </div>
                            </div>
                            <span asp-validation-for="PolicyTb.StudentAmt" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>Minimum number of visit institution supervisor is to visit IT student</label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-2">
                                        <input type="text" asp-for="PolicyTb.MinVisit4Super" class="form-control" id="txtminvisitsuper">
                                    </div>
                                </div>
                            </div>
                            <span asp-validation-for="PolicyTb.MinVisit4Super" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>SIWES Duration Format </label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-2">
                                        <select asp-for="PolicyTb.MaxSiwesCap" class="form-control select2 select2-purple" data-dropdown-css-class="select2-purple"
                                                style="width: 100%;" id="drpbased">
                                            <option selected="selected" value="0">--Select--</option>
                                            <option value="1">Day</option>
                                            <option value="2">Week</option>
                                            <option value="3">Month</option>
                                            <option value="4">Year</option>
                                        </select>
                                    </div>
                                    <span style="width:10px"></span>
                                    <label>(Day; Week; Month; Year).</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="input-group">
                                    <label>Master List must be submitted on or before</label>
                                    <span style="width:10px"></span>
                                    <div class="col-md-4">
                                        <input type="date" class="form-control" id="txtmasterlistdate">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="form-group">
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" asp-for="PolicyTb.DelistInst" class="custom-control-input" id="chkboxdelist" />
                                    <label class="custom-control-label" for="chkboxdelist">
                                        Delist institutions that did not submit their List (Master & Placement) at the set Time.
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div id="divadd" class="justify-content-center" style="margin-left:35%; margin-bottom:1%;">
                    <button type="submit" id="Btnsave" class="btn btn-primary button button4">Add New Records</button>
                    @*<button type="submit" id="Btnupdate" class="btn btn-primary button button4">Update Record</button>*@
                </div>
            </form>

    </div>
</div>
    <script type="text/javascript">
    $(document).ready(function () {
        formClear();
        function formClear() {
             $("#txtcode").val("");
             $("#txtshortcode").val("");
             $("#txtname").val("");
             $("#txtaddr1").val("");
             $("#txtaddr2").val("");
             $("#nationChange").val("");
             $("#myState").val("");
             $("#myLGA").val("");
             $("#txtzip").val("");
             $("#txtphone1").val("");
             $("#txtemail").val("");
             $("#txtwebsite").val("");
             $("#txtContactname").val("");
             $("#txtContactphone").val("");
             $("#txtContactemail").val("");
             //$("#txtdrpdeact").val("0");
             //$("#txtdeactDate").val("");

             $("#Btnsave").show();
             $("#Btnupdate").hide();
            }
        $('#BtnCancel').on('click', function (e) {
                e.preventDefault();
                formClear();
            });
        $('#Btnupdate').on('click', function (e) {
            e.preventDefault();
             var readid = document.getElementById('readid').value;
              var txtcode = document.getElementById('txtcode').value;
             var txtshortcode = document.getElementById('txtshortcode').value;
             var txtname = document.getElementById('txtname').value;
             var txtaddr1 = document.getElementById('txtaddr1').value;
             var txtaddr2 = document.getElementById('txtaddr2').value;
             var nationChange = document.getElementById('nationChange').value;
             var myState = document.getElementById('myState').value;
             var myLGA = document.getElementById('myLGA').value;
             var txtzip = document.getElementById('txtzip').value;
             var txtphone1 = document.getElementById('txtphone1').value;
             var txtemail = document.getElementById('txtemail').value;
             var txtwebsite = document.getElementById('txtwebsite').value;
             var txtContactname = document.getElementById('txtContactname').value;
             var txtContactphone = document.getElementById('txtContactphone').value;
             var txtContactemail = document.getElementById('txtContactemail').value;
             //var txtdrpdeact = document.getElementById('txtdrpdeact').value;
             //var txtdeactDate = document.getElementById('txtdeactDate').value;

              var d = {
                    "Id": Number(readid),
                "Code": txtcode,
                "ShortCode": txtshortcode,
                "Name": txtname,
                "Address1": txtaddr1,
                "Address2": txtaddr2,
                "Country": nationChange,
                "State": myState,
                "City": myLGA,
                "ZipCode": txtzip,
                "PhoneNo": txtphone1,
                "Email": txtemail,
                "WebAddress": txtwebsite,
                "NameOfCPerson": txtContactname,
                "CPersonPhone": txtContactphone,
                "CPersonEmail": txtContactemail,
                //"Deactivate": txtdrpdeact,
                //"DeactDate": txtdeactDate,
             };
            //alert(editindex); alert(txtname); alert(txtcode); alert(drpListCat); alert(drpAgency);
            //return false;
            var t = serialNo - 1;
            var baseUrl = window.location.origin;
            $.ajax({
                type: "PUT",
                url: baseUrl + '/Api/AgencySuperSetups/' + readid,
                data: JSON.stringify(d),
                xhrFields: {
                    withCredentials: true
                },
                contentType: "application/json; charset=utf-8",
                error: function (data) {
                    alert(data.responseText);

                },
                failure: function (data) {
                    alert(data.responseText);
                },
                success: function (data) {
                    alert(" Record Updated Successfully");
                    $('.readid.' + t).text(data["id"]);
                        $('.tabcode.' + t).text(data["code"]);
                        $('.tabname.' + t).text(data["name"]);
                        formClear();
                    $('#txtcode').prop("readonly", true);
                    document.getElementById('divgrid').style.display = "block";
                    document.getElementById('divinput').style.display = "none";
                    location.reload();
                },
            });
        });
         $("#txtcode" ).on('change', function (e) {
             e.preventDefault();
            // alert("i changee2");
        var readid = document.getElementById('readid').value;
        var txtcode = document.getElementById('txtcode').value;
             if (readid == "")
             {
                 $('#txtcode').prop("readonly", false);
                 $('#txtcode').val(txtcode);
                 $("#Btnsave").show();
                 $("#Btnupdate").hide();
            }
             else {
                 var d = {
                    "Id": readid
                };
                var baseUrl = window.location.origin;
                $.ajax({
                    type: "GET",
                    url: baseUrl + '/Api/AgencySuperSetups/' + readid,
                    data: JSON.stringify(d),
                    xhrFields: {
                        withCredentials: true
                    },
                    contentType: 'json',
                    error: function (data) {
                        alert(data.responseText);
                    },
                    failure: function (data) {
                        alert(data.responseText);
                    },
                    success: function (data) {
                        // populate txtbox
                        $("#Btnsave").hide();
                        $("#Btnupdate").show();
                        $('#txtcode').val(txtcode);
                        $('#txtcode').prop("readonly", true);
                        $('#txtshortcode').val(data["txtshortcode"]);
                        $("#txtname").val(data["Name"]);
                        $("#txtaddr1").val(data["Address1"]);
                        $("#txtaddr2").val(data["Address2"]);
                        $('#nationChange').val(data["country"]);
                        $("#myState").val(data["State"]);
                        $("#myLGA").val(data["City"]);
                        $("#txtzip").val(data["ZipCode"]);
                        $("#txtphone1").val(data["PhoneNo"]);
                        $("#txtemail").val(data["Email"]);
                        $("#txtwebsite").val(data["WebAddress"]);
                        $("#txtContactname").val(data["NameOfCPerson"]);
                        $("#txtContactphone").val(data["CPersonPhone"]);
                        $("#txtContactemail").val(data["CPersonEmail"]);
                    },
                });
            }
         })
    });
    </script>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
